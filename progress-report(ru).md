Без малого пять лет назад назад в JetBrains Research — исследовательском отделе соответствующей фирмы, возник интереснейший и очень амбициозный проект — создание языка для записи математических теорем и их доказательств, пригодного для того чтобы ими могли пользоваться обыкновенные математики, то есть математики, работающие в областях алгебры, анализа, геометрии, топологии или теории чисел, используя классическую логику и аксиому выбора.

Мы осознавали и то, что эту задачу решают уже 300 лет, и то, что принципиально работающее решение имеется в распоряжении с 1973 года, однако мы также знали, что только-только подоспели решающие прорывы, позволяющие, предположительно, решить эту задачу на качественно новом уровне.

§ Mizar System
--------------

С 1973 года существует система Mizar, решающая в точности эту задачу. Система Mizar состоит из формального языка для доказательств и программы, механически проверяющей их корректность. Mizar базируется на стандартной аксиоматической теории множеств ZFC, чего в точности достаточно для нужд “обыкновенных математиков”, как мы их определили выше. Более того, опционально Mizar позволяет использовать теорию множеств Тарского-Гротендика — расширение стандартной теории множеств, позволяющее работать с базовыми приложениями теории категорий, в первую очередь — с алгебраической геометрией Гротендика. Система Mizar может быть адаптирована и для использование ещё более сильной теории множеств ZMC/S, позволяющий с комфортом работать с теорией категорий и любыми её приложениями (см. https://golem.ph.utexas.edu/category/2009/11/feferman_set_theory.html).

Библиотека Mizar Mathematical Library — крупнейший согласованный корпус формализованных математических результатов.

Однако использование теории множеств напрямую сродни программированию на ассемблере. Колоссальный опыт использования Mizar'а, а также попыток создать вокруг него развитый инструментарий, указывает на то, что повысить продуктивность и удобство невозможно, не перейдя к более высокоуровневому, структурному языку.

§ Прорывы недавнего времени и наши идеи
---------------------------------------

* В 2006-2014 годах Владимиром Воеводским и др. был достигнут огромный прорыв в понимании природы равенства в интуиционистской логике первого порядка, в ходе обширной исследовательской программы была на новом уровне понята система естественной дедукции для интуиционистской логики первого порядка и разработаны её естественные расширения — гомотопические и унивалентные теории типов. Унивалентные теории типов представляют из себя очень выразительные структурные языки для формулировки и доказательства математических утверждений, однако обладают фундаментальным ограничением по выразительности: невозможно говорить обо “всех” группах, “всех” кольцах и т.д., можно говорить только об U-малых группах, кольцах и т.д. для фиксированной вселенной U. За прошедшие годы Валерий Исаев с коллегами разработал формальный язык Arend, реализующий на практике результаты этих изысканий, и обширный (в т.ч. интерактивный) инструментарий для него.

* Aaron Stump и др. разработали вариант исчисления построений (Core Cedille) одновременно включающий себя интуиционистскую теорию типов (без вселенных) и параметрические кванторы всеобщности, позволяющие говорить обо “всех“ группах, “всех” кольцах и даже более того “всех” локально-малых категориях структурированных объектов, 2-категории локально-малых категорий структурированных объектов, функторов и естественных преобразований и т.д. Мы полагаем, что эту теорию можно расширить, добавив вселенные с сильным принципом рефлексии (как в ZMC/S), и таким образом совместить все преимущества: достаточная выразительность, чтобы говорить о собственных классах объектов, и все преимущества унивалентных теорий типов.

* Мы хотим сделать использование неконструктивных принципов (аксиома выбора и её ослабленные формулировки, включая закон исключённого третьего) доступным не в виде глобальных аксиом, которые можно только включить или выключить на уровне целой библиотеки, а в виде локальных модальностей: если требуется в конкретном месте доказательства, чтобы, например, тип `T` обладал разрешимым равенством, можно потребовать наличие “оракула, проверяющего равенство элементов T” в качестве дополнительного вводного теоремы. Возможность свободно переходить между классической и интуиционистской модальностью позволяет сочетать удобства классической и интуиционистской логики.

* Для удобства работы необходима возможность неявной идентификации эквивалентных типов как одного и того же подмножества общего надтипа (скажем, двух расширений поля рациональных чисел как подмножеств его алгебраического замыкания, или, более прозаично, чётных неотрицательных чисел как подмножества натуральных и как подмножества целых чисел), и необходима поддержка орнаментов — инфраструктуры удобного механизированного перехода между родственными индуктивными типами. Оба механизма можно рассматривать как синтаксический сахар, однако отсутствие этих механизмов плодит сущий ад явных конверсий.


§ Обзор: Классическая и интуиционистская логика
-----------------------------------------------

Сперва я напомню, что такое классическая и интуиционистская логика, и чем они различаются: названия “классическая” и “интуиционистская” очень неудачные, они связаны с историей логики как науки, и не имеют никакого содержательного смысла.

В теории познания существуют понятия open world assumption (OWA) и closed world assumption (CWA). Классическую логику следовало бы называть CWA-логикой — она исходит из того, что любой корректно сформулированный бинарный вопрос обязательно имеет определённый ответ — да или нет. Интуиционистскую логику следовало бы называть OWA-логикой — она допускает существование открытых вопросов. Разумеется, в рамках интуиционистской логики про широкий класс вопросов можно показать, что они всё же имеют определённый ответ, но допускается существование утверждений, про которые мы не можем доказать ни, что они истины, ни, что они ложны. Система естественной дедукции для OWA-логики первого порядка с равенством (т.е. “язык, на котором записываются доказательства в рамках OWA-логики высшего порядка с равенством”) тоже по историческим причинам имеет странное название — она называется Intuitionistic (∃∀=)-Type Theory (Intuitionistic Type Theory with truncated Σ-types, extensional Π-types and Id types only, no inductive types, no universes).

В стародавние времена казалось, что наличие в той или иной теории открытых вопросов это результат некачественно сделанной системы аксиом — стоит только подумать поглубже, и можно будет придумать добиться полноты аксиоматической системы, т.е. вот ровно того свойства, что всякое утверждение может быть либо доказано, либо опровергнуто. Окончательное отрезвление пришло лишь в 1960ые годы. Важным для понимания стал результат 1963 года, что существование множеств строго больше множества натуральных чисел, но строго множества вещественных чисел не может быть ни доказано, ни опровергнуто в рамках стандартной теории множеств. Более того, если мы пропатчим теорию (например, добавим постулат, что таких множеств нет), то для пропатченной теории можно сгенерировать следующий открытый вопрос о существовании множеств определённой большой мощности, которые невозможно ни построить, ни исключить. Теория, не имеющая конечных моделей, не может “жестко зафиксировать” собственную предметную вселенную.

Это понимание привело многих математиков к мысли, что OWA-логика вообще-то является более предпочтительным основанием. Но как же быть с огромным корпусом математических результатов, доказанных в рамках CWA-логики? “Снести до основанья, а потом”? Конечно нет! Доказательства, проведённые в рамках CWA-логики могут быть “переосмыслены” (интерпретированы) в рамках OWA-логики, только доказывать они будут немного другие утверждения. Например, если мы классически доказали утверждение `P`, не содержащее кванторов, то это же доказательство в рамках OWA-логики доказывает утверждение `¬¬P`. Доказательства утверждения вида `∃x, P(x)` для предикатов `P` без кванторов, превращаются в доказательства `¬∀x, ¬P(x)`, и так далее.

Вообще говоря, схема перевода зависит от того, в рамках какой теории мы работаем. Например, в рамках арифметики, высказывания с не более чем одним квантором существования (и любым количеством кванторов всеобщности) вообще не изменяются. Для теории множеств ZF (без аксиомы выбора) существует интуиционистский вариант IZF с несложной схемой трансляции. Если добавить аксиому зависимого выбора DC, трансляция существенно усложняется. Я слышал, что существует и схема трансляции для варианта, где к DC добавлена лемма об ультрафильтре, тоже ослабленный вариант аксиомы выбора, эквивалентный в частности теореме Хана-Банаха, хотя подробно не разбирался. Существует ли универсальная схема трансляции для теории множеств с полной аксиомой выбора я навскидку не знаю.

При “переосмысливании” старых доказательств в рамках нового формализма часто выходит, что важно какие именно средства были использованы при доказательстве. Если доказательство вообще нигде не использовало закон исключённого третьего (LEM) или аксиомы, имплицирующие его (полная аксиома выбора), то переосмысливать вообще нечего. Во всех остальных случаях — чем реже использовался LEM, тем более сильное высказывание доказывается.

Систему естественной дедукции для OWA-логики несложно превратить в систему дедукции для CWA-логики, для этого достаточно добавить оператор неконструктивного выбора 

Часто бывает, что какое-то утверждение можно доказать либо при помощи аксиомы выбора AC, либо при помощи более слабых аксиом — аксиомы зависимого выбора DC и/или леммы об ультрафильтрах UL. Так вот, после “переосмысливания” доказательств в OWA-смысле выходит, что доказательства, использующие более слабые инструменты, доказывают строго более сильные утверждения.
